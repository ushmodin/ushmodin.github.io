---
layout: post
title: Мысли о C10K
tags:
  - hightload
  - C10K
main-class: C10K
introduction: 'Немного мыслей о - проблеме C10K'
draft: true
---

**Друзья, всем привет!**

Давайте представим, что нам пришла интересная идея для стартапа. 
Мы фигак-фигак, накидали мобильное приложение и сервер для него и в продакшен. 
Попросили друзей попробовать потыкать, написали статьи на хабр или [http://vc.ru]. 
Всем понравилось и количество скачеваний начинает расти. 
Мы потирая руки уже начали продумывать способ монетизации. 
Но на почту начали приходить письма об ошибках. 
Давайте пропустим ошибки логики или программирования. 
Сейчас хотелось бы поговорить об ошибках когда мобильное приложение обратилось на сервер за данными,
а сервер отказывался принимать подключение или вернул HTTP код 429 (Too many requests).

Сервер ведет себя таким образом, когда количество одновременно обрабатываемых запросов достигло определенного количества. 
И чтобы сохранить роботоспособность и довести до конца уже работающие запросы, сервер отказывается принимать следующие запросы. 

Сервер Apache Tomcat7 каждого запроса создает отдельный поток.
После того как ответ отправлен, поток переходит в режим ожидания.
Если во время того пока обрабатывался запрос, пришел другой запрос будет создан отдельный поток.
По умолчанию, максимальное количество одновременно работающих потоков 200. Если пришло больше, то потоки не создаются а запросы становятся в очередь. По умолчанию длинна очереди 100. Получается, если в короткий промежуток времени пришло 300 запросов, то последующие запросы сервер откажется принимать. Этот промежуток времени должен быть меньше чем время обработки запроса.
 
